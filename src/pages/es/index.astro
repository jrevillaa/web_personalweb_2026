---
import BaseLayout from "../../components/layout/BaseLayout.astro";
import HeroIntro from "../../components/sections/HeroIntro.astro";
import TrustSignals from "../../components/sections/TrustSignals.astro";
import MoodleXRayPreview from "../../components/sections/MoodleXRayPreview.astro";
import PluginMapPreview from "../../components/sections/PluginMapPreview.astro";
import Testimonials from "../../components/sections/Testimonials.astro";
import ConfidentialityNote from "../../components/ui/ConfidentialityNote.astro";
import es from "../../i18n/es.json";
import { getCollection } from "astro:content";

const title = es["site.title"];
const description = es["site.description"];

// Dynamic Plugin Categories
const allPlugins = await getCollection("plugins");
const esPlugins = allPlugins.filter((p) => p.data.lang === "es");
const uniqueTypes = [...new Set(esPlugins.map((p) => p.data.type))];
const pluginCategories = uniqueTypes.map(
  (type) => es[`plugin_types.${type}`] || type,
);

// Dynamic X-Ray Items
const allXray = await getCollection("xray");
const xrayItems = allXray
  .filter((item) => item.data.lang === "es")
  .sort((a, b) => a.data.order - b.data.order)
  .map((item) => ({
    title: item.data.title,
    description: item.data.description,
    icon: item.data.icon,
  }));
---

<BaseLayout title={title} description={description} lang="es">
  <main>
    <HeroIntro
      title={es["hero.greeting"]}
      subtitle={es["hero.role"]}
      ctaText={es["hero.cta"]}
      ctaLink="/es/contacto"
    />

    <TrustSignals
      years={es["trust.years"]}
      yearsLabel={es["trust.years_label"]}
      plugins={es["trust.plugins"]}
      pluginsLabel={es["trust.plugins_label"]}
      clients={es["trust.clients"]}
      clientsLabel={es["trust.clients_label"]}
      badges={es["badges"]}
    />

    <MoodleXRayPreview title={es["xray.title"]} items={xrayItems} />

    <PluginMapPreview
      title={es["plugins_map.title"]}
      description={es["plugins_map.description"]}
      categories={pluginCategories}
      ctaText={es["plugins_map.cta"]}
      ctaLink="/es/plugins"
    />

    <div class="container">
      <ConfidentialityNote text={es["disclaimer.text"]} />
    </div>

    <Testimonials
      title={es["testimonials.title"]}
      items={es["testimonials.items"]}
    />
  </main>
</BaseLayout>
