---
import { getCollection } from "astro:content";
import BaseLayout from "../../../components/layout/BaseLayout.astro";
import PluginCard from "../../../components/ui/PluginCard.astro";
import ConfidentialityNote from "../../../components/ui/ConfidentialityNote.astro";
import en from "../../../i18n/en.json";

const allPlugins = await getCollection("plugins");
const enPlugins = allPlugins.filter((post) => post.data.lang === "en");
const uniqueTypes = [...new Set(enPlugins.map((p) => p.data.type))];

const title = "Plugin Directory | Jair Revilla";
const description =
  "Collection of Moodle plugins, blocks, and modules developed to solve complex problems.";
---

<BaseLayout title={title} description={description} lang="en">
  <main class="container">
    <header class="plugins-header">
      <h1 class="page-title">Plugin Directory</h1>
      <p class="page-desc">Robust solutions to extend Moodle functionality.</p>
    </header>

    <ConfidentialityNote text={en["disclaimer.text"]} />

    <div class="filters-container">
      <button class="filter-btn active" data-filter="all">All</button>
      {
        uniqueTypes.map((type) => (
          <button class="filter-btn" data-filter={type}>
            {en[`plugin_types.${type}`] || type}
          </button>
        ))
      }
    </div>

    <div class="plugins-grid">
      {
        enPlugins.map((plugin) => (
          <div class="plugin-wrapper" data-type={plugin.data.type}>
            <PluginCard
              name={plugin.data.name}
              type={plugin.data.type}
              version={plugin.data.version}
              description={plugin.data.description}
              features={plugin.data.features}
              url={`/en/plugins/${plugin.slug.replace("-en", "")}`}
            />
          </div>
        ))
      }
    </div>
  </main>
</BaseLayout>

<script>
  const filterBtns = document.querySelectorAll(".filter-btn");
  const pluginItems = document.querySelectorAll(".plugin-wrapper");

  filterBtns.forEach((btn) => {
    btn.addEventListener("click", () => {
      // Remove active class from all
      filterBtns.forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");

      const filterValue = btn.getAttribute("data-filter");

      pluginItems.forEach((item) => {
        const itemType = item.getAttribute("data-type");
        if (filterValue === "all" || filterValue === itemType) {
          (item as HTMLElement).style.display = "block";
        } else {
          (item as HTMLElement).style.display = "none";
        }
      });
    });
  });
</script>

<style>
  .plugins-header {
    padding: var(--space-8) 0;
    text-align: center;
  }

  .page-title {
    font-size: 2.5rem;
    margin-bottom: var(--space-2);
  }

  .page-desc {
    color: #666;
    font-size: 1.2rem;
  }

  .filters-container {
    display: flex;
    justify-content: center;
    gap: var(--space-3);
    flex-wrap: wrap;
    margin-bottom: var(--space-8);
  }

  .filter-btn {
    background: transparent;
    border: 1px solid var(--color-border);
    padding: var(--space-2) var(--space-4);
    border-radius: 100px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s ease;
    color: var(--color-text);
  }

  .filter-btn:hover,
  .filter-btn.active {
    background: var(--color-primary);
    color: #fff;
    border-color: var(--color-primary);
  }

  .plugins-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--space-6);
    padding-bottom: var(--space-12);
  }
</style>
