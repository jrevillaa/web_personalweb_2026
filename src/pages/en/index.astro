---
import BaseLayout from "../../components/layout/BaseLayout.astro";
import HeroIntro from "../../components/sections/HeroIntro.astro";
import TrustSignals from "../../components/sections/TrustSignals.astro";
import MoodleXRayPreview from "../../components/sections/MoodleXRayPreview.astro";
import PluginMapPreview from "../../components/sections/PluginMapPreview.astro";
import Testimonials from "../../components/sections/Testimonials.astro";
import ConfidentialityNote from "../../components/ui/ConfidentialityNote.astro";
import en from "../../i18n/en.json";
import { getCollection } from "astro:content";

const title = en["site.title"];
const description = en["site.description"];

// Dynamic Plugin Categories
const allPlugins = await getCollection("plugins");
const enPlugins = allPlugins.filter((p) => p.data.lang === "en");
const uniqueTypes = [...new Set(enPlugins.map((p) => p.data.type))];
const pluginCategories = uniqueTypes.map(
  (type) => en[`plugin_types.${type}`] || type,
);
---

<BaseLayout title={title} description={description} lang="en">
  <main>
    <HeroIntro
      title={en["hero.greeting"]}
      subtitle={en["hero.role"]}
      ctaText={en["hero.cta"]}
      ctaLink="/en/contact"
    />

    <TrustSignals
      years={en["trust.years"]}
      yearsLabel={en["trust.years_label"]}
      plugins={en["trust.plugins"]}
      pluginsLabel={en["trust.plugins_label"]}
      clients={en["trust.clients"]}
      clientsLabel={en["trust.clients_label"]}
      badges={en["badges"]}
    />

    <MoodleXRayPreview title={en["xray.title"]} items={en["xray.items"]} />

    <PluginMapPreview
      title={en["plugins_map.title"]}
      description={en["plugins_map.description"]}
      categories={pluginCategories}
      ctaText={en["plugins_map.cta"]}
      ctaLink="/en/plugins"
    />

    <div class="container">
      <ConfidentialityNote text={en["disclaimer.text"]} />
    </div>

    <Testimonials
      title={en["testimonials.title"]}
      items={en["testimonials.items"]}
    />
  </main>
</BaseLayout>
