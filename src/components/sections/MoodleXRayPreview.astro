---
const { title, items = [] } = Astro.props;
---

<section id="xray" class="xray-preview">
  <div class="container">
    <h2 class="section-title">{title}</h2>

    <div class="xray-grid">
      {
        items
          .sort(() => 0.5 - Math.random()) // Server-side shuffle (Initial state)
          .map((item) => (
            <a
              href={`/${item.lang === "es" ? "es" : "en"}/xray/${item.slug.replace(`-${item.lang === "es" ? "es" : "en"}`, "")}`}
              class="xray-card"
            >
              <div class="xray-icon">
                <i class={item.icon} />
              </div>
              <h3 class="xray-card-title">{item.title}</h3>
              <p class="xray-card-desc">{item.description}</p>
            </a>
          ))
      }
    </div>
  </div>
</section>

<script>
  // Client-side shuffle to ensure randomness on every refresh
  document.addEventListener("DOMContentLoaded", () => {
    const grid = document.querySelector(".xray-grid");
    if (grid) {
      for (let i = grid.children.length; i >= 0; i--) {
        grid.appendChild(grid.children[(Math.random() * i) | 0]);
      }
    }
  });
</script>

<style>
  .xray-preview {
    padding: var(--space-12) 0;
    background-color: #fff;
  }

  .section-title {
    text-align: center;
    font-size: 2rem;
    margin-bottom: var(--space-8);
    color: #1a1a1a;
  }

  .xray-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-6);
  }

  /* Show only the first 4 items */
  .xray-card:nth-child(n + 5) {
    display: none;
  }

  /* Tablet */
  @media (min-width: 768px) {
    .xray-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  /* Desktop */
  @media (min-width: 1024px) {
    .xray-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  .xray-card {
    background: #fff;
    padding: var(--space-6);
    border-radius: var(--radius-2);
    box-shadow: var(--shadow-1);
    transition:
      transform 0.2s ease,
      box-shadow 0.2s ease;
    border: 1px solid #eee;
    text-align: center;
    text-decoration: none;
    display: block;
    color: inherit;
  }

  .xray-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-2);
    border-color: var(--color-primary);
  }

  .xray-card:hover .xray-icon {
    color: var(--color-primary);
  }

  .xray-icon {
    font-size: 2.5rem;
    margin-bottom: var(--space-4);
    display: inline-block;
  }

  .xray-card-title {
    font-size: 1.25rem;
    margin-bottom: var(--space-2);
    color: #1a1a1a;
  }

  .xray-card-desc {
    font-size: 0.9rem;
    color: #666;
    line-height: 1.4;
    margin: 0;
  }
</style>
